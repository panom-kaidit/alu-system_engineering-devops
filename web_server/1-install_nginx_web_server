#!/usr/bin/env bash
set -e

# Ensure script is run as root
if [ "$(id -u)" -ne 0 ]; then
	echo "This script must be run as root" >&2
	exit 1
fi

export DEBIAN_FRONTEND=noninteractive

# Update packages and install nginx
apt-get update -y
apt-get install -y nginx

# adding Holberton message
cat > /var/www/html/index.html <<'EOF'
Holberton School for the win!
EOF

#making it work on port 80
cat > /etc/nginx/sites-available/default <<'EOF'
server {
		listen 80 default_server;
		listen [::]:80 default_server;

		root /var/www/html;
		index index.html;

		server_name _;

		location / {
				try_files $uri $uri/ =404;
		}
}
EOF

# Restart nginx without using systemctl
if command -v service >/dev/null 2>&1; then
	service nginx restart || service nginx start || true
else
	/etc/init.d/nginx restart || /etc/init.d/nginx start || true
fi

# Allow port 80 through ufw if available (best-effort)
if command -v ufw >/dev/null 2>&1; then
	ufw allow 80/tcp || true
fi

exit 0